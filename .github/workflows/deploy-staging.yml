name: "Deploy RC to Staging"
on:
  pull_request:
    branches:
      - master

jobs:
  main:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1
      - name: Trigger Spinnaker pipeline
        run: |
          curl -H "Content-Type: application/json" \
          -d "{\"secret\": \"This webhook allows only known peers\", \"parameters\": { \"serviceName\": \"orca\", \"serviceImage\": \"2021.03.08.16.59.39.master\"} }" \
          -X POST https://spinnaker.cloud.armory.io/api/v1/webhooks/webhook/staging-cd
#      - uses: armory-io/spin-trigger-pipeline-action@0.0.1
#        with:
#          baseUrl: https://spinnaker.cloud.armory.io/api/v1
#          source: staging-cd
#          serviceName: orca
#          serviceImage: 2021.03.08.16.59.39.master
#          secret: This webhook allows only known peers
#        id: trigger